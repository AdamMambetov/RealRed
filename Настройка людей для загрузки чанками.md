# Настройка людей для загрузки чанками

Здесь инструкция по тому, как настроить людей _Anima4D_ в презентации, чтобы они грузились по чанкам. Я буду показывать на примере Брусники Октябрьской.

> [!warning] ОЧЕНЬ ВАЖНО!
> Система работает так: если персонаж пересекает чанк, то включаются люди из этого чанка и ещё из тех чанков, которые пересекаются с чанком, в котором перснаж.
> Пример 1. ![[Pasted image 20250704161805.png]]
> Если персонаж окажется в чанке посередине, остальные два чанка не загрузятся, потому что коллизии чанков не пересекаются.
> Пример 2. ![[Pasted image 20250704161952.png]]
> Если персонаж окажется в чанке посередине, остальные два чанка загрузятся, потому что коллизии чанков пересекаются.
> Пример 3. ![[Pasted image 20250704162120.png]]
> Если персонаж окажется в чанке слева, загрузится чанк посередине, потому что коллизии этих чанков пересекаются. Чанк справа не загрузится, потому что он пересекается с чанком посередине, а не с чанком, в котором сейчас персонаж.
 
 1. Добавьте людей на карту (я не знаю как добавить _Anima4D_ людей, поэтому разбирайтесь сами)
	 - Если они уже есть, то обязательно загрузите их из _Data Layer_!!!
 2. У людей надо выставить _Collision Preset_ на _People_ ![[Pasted image 20250704150915.png]]
 3. Добавьте на карту Блюпринт _RR_PeopleChunk_ в директории "/All/Plugins/EstateExplorerPlugin/EstateExplorer/Systems/PeopleCulling". Расположите его чуть ниже земли, чтобы он точно захватил людей в области. Задайте свойство _Chunk Tag_ как здесь: ![[Pasted image 20250704152739.png]] Если таких тэгов нет, то добавьте их в _Project Settings_.
	 - Как часто ставить чанки непонятно, система не протестирована. Лично я ставил по чанку на сторону дома, а во дворах ставил так, чтобы было до 8 человек в одном чанке.
	 - Для удобства положите чанки в отдельную папку как здесь: ![[Pasted image 20250704151822.png]] 07 - очередь, 01 - номер чанка.
	 - Используйте свойство _Box Extent_ чтобы задать размер чанка, вместо _Scale_
 4. Создайте в 2 раза больше _Data Layer'ов_, чем чанков (это для зимних и летних людей). Перейдите в директорию "/All/Game/Brusnika_OKT/Data_Layers" и создайте "World/Data Layer". Откройте его и выставите _Data Layer Type_ в _Runtime_.
	 - Лайфках. Можете сначала создать по одному _Data Layer_ для зимних и летних, указать им название первого чанка как здесь: ![[Pasted image 20250704154435.png]], настроить их и просто дублировать их на _Ctrl + D_. Также кстати можно поступить и с чанками.
 5. Добавьте все _Data Layer'ы_ для чанков на карту. Во вкладке _Data Layers_ создайте приватный _Data Layer_ для конкретной очереди и перетащите все чанки этой очереди в него. ![[Pasted image 20250704160021.png]]
	 - Приватный _Data Layer_ нужен просто для организации, т.е. он как папка в проводнике.
	 - По итогу должно получится что-то вроде этого: ![[Pasted image 20250704155932.png]]
 6. Теперь надо связать _Data Layer'ы_ чанков с тегами. Откройте _BRU_People_DT_ в директории "/All/Game/Brusnika_OKT/DataTable". Добавьте новую строку ![[Pasted image 20250704163303.png]] В этой строке укажите: _ID_ - тэг чанка, _SummerDataLayer_ - летний _Data Layer_, _WinterDataLayer_ - зимний _Data Layer_.
	 - Лайфхак. Их тоже можно дублировать на _Ctrl + D_.
	 - Поле _Row Name_ никак не используется, можете его не менять.
 7. Теперь надо добавить людей на уровне в _Data Layer'ы_. Если не все летние или зимние люди загружены, то обязательно загрузите их! Запустите _EUW_PeopleToDataLayer_ в директории "/All/Plugins/EstateExplorerPlugin/EstateExplorer/Systems/PeopleCulling", нажмите правой кнопкой по нему и нажмите _Run Editor Utility Widget_ ![[Pasted image 20250704172638.png]] В появившемся окошке укажите _Data Table_ с чанками ![[Pasted image 20250704172753.png]] Первая кнопка обновляет все чанки, которые выделены в _Outliner_, а вторая - все чанки на карте.